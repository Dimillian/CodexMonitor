# Windows Support Spec

## Goal

Ship a **fully functioning Windows version** of CodexMonitor with:

- **Auto-updater** enabled and wired into the release workflow (`latest.json` includes Windows).
- **Dictation** working on Windows (same UX + model management as other platforms).

This spec is the source of truth for Windows support requirements and acceptance criteria.

## Target Platforms

- Windows 10/11, **x86_64** (GitHub Actions `windows-latest`).

## Non-Goals (for this milestone)

- Authenticode / EV code signing (nice-to-have; not required to be functional).
- Windows ARM64 builds.

## Functional Requirements

### Updater (Required)

- Windows release artifacts must be produced by CI and attached to GitHub Releases.
- `latest.json` must include a **Windows platform entry** with:
  - correct asset URL
  - signature generated by Tauri updater signing
- In-app updater must be enabled for Windows builds (same endpoints + pubkey as other platforms).
- The updater entry for Windows uses the **NSIS installer** (`.exe` + `.exe.sig`) as the updater bundle.

### Dictation (Required)

Dictation must work on Windows with the same surface area as other platforms:

- Model status: missing/downloading/ready/error
- Model download/cancel/remove
- Session lifecycle: start/listening/stop->processing/transcript/cancel
- Emits the same Tauri events:
  - `dictation-download`
  - `dictation-event`

Implementation choice for this milestone:

- Use the existing Whisper-based implementation on Windows (via `whisper-rs` + `cpal`).

### Windows UX Correctness (Required)

- “Reveal in Finder” strings must be platform-aware (“Explorer” on Windows).
- Opening paths in an editor or file manager must behave correctly on Windows.

## Build & Tooling Requirements

### Windows Build Prereqs (dev + CI)

Required on Windows to build dictation (Whisper + bindgen):

- CMake
- LLVM/Clang (for `bindgen` / `libclang`)

`npm run doctor:win` must fail fast with actionable instructions if missing.
`npm run doctor:win` must correctly detect installed dependencies on Windows/macOS/Linux.

## CI / Release Requirements

### CI (Required)

- Add a Windows job to `.github/workflows/ci.yml` that:
  - installs deps
  - runs a Windows Tauri debug build (`--no-bundle`) using the Windows config

### Release (Required)

Update `.github/workflows/release.yml` to include Windows:

- Build Windows bundles on `windows-latest`
- Upload `.msi` / `.exe` plus updater `.sig` artifacts
- Include Windows in generated `latest.json`

## Acceptance Criteria

- `npm run tauri:build:win` succeeds on Windows.
- Windows release workflow publishes installers and `latest.json` that enables in-app updates.
- Dictation works on Windows end-to-end (model download → hold-to-talk → transcript).
- Repo checks pass:
  - `npm run lint`
  - `npm run test`
  - `npm run typecheck`
  - Rust checks executed in CI for Windows/macOS as configured
